# מדריך פריסה פשוט – שלב אחרי שלב

העלאת הבלוג ל־GitHub, הרצה ב־Netlify וחיבור ל־Supabase.

---

## חלק 1: Supabase (מסד נתונים + התחברות)

### שלב 1.1 – יצירת חשבון ופרויקט

1. היכנס לאתר **[supabase.com](https://supabase.com)** ולחץ **Start your project**.
2. הירשם (אפשר עם GitHub).
3. לחץ **New Project**.
4. מלא:
   - **Name:** `gaming-blog` (או כל שם).
   - **Database Password:** בחר סיסמה חזקה **ושמור אותה**.
   - **Region:** בחר קרוב אליך (למשל Frankfurt).
5. לחץ **Create new project** וחכה כדקה עד שהפרויקט מוכן.

---

### שלב 1.2 – הרצת טבלאות המסד

1. בתפריט השמאלי לחץ **SQL Editor**.
2. לחץ **+ New query**.
3. פתח במחשב את הקובץ:  
   `gaming-blog/supabase/schema.sql`  
   העתק **את כל התוכן** שלו והדבק בחלון ה־SQL.
4. לחץ **Run** (או Ctrl+Enter).
5. אמור להופיע שההרצה הצליחה (ירוק).

---

### שלב 1.3 – העתקת מפתחות

1. בתפריט השמאלי לחץ **Settings** (איקון גלגל שיניים).
2. לחץ **API**.
3. תחת **Project URL** – לחץ **Copy** והעתק למקום זמני (נצטרך בהמשך).
4. תחת **Project API keys** – מצא את **anon** **public** ולחץ **Copy** – גם אותו שמור.

**סיכום:** יש לך עכשיו:
- **Project URL** (משהו כמו `https://xxxxx.supabase.co`)
- **anon key** (מחרוזת ארוכה שמתחילה ב־`eyJ...`)

---

## חלק 2: GitHub (העלאת הקוד)

### שלב 2.1 – יצירת Repository

1. היכנס ל־**[github.com](https://github.com)** והתחבר.
2. לחץ על **+** למעלה מימין → **New repository**.
3. **Repository name:** `gaming-blog` (או שם אחר).
4. השאר **Public**.
5. **אל תסמן** "Add a README" – רוצים repo ריק.
6. לחץ **Create repository**.

---

### שלב 2.2 – העלאת הקבצים מהמחשב

1. במחשב שלך, פתח **Terminal** (או Command Prompt).
2. נווט לתיקיית הפרויקט:
   ```bash
   cd /Users/omerokon/Desktop/bf6/gaming-blog
   ```
   (אם הפרויקט אצלך במקום אחר – החלף את הנתיב)

3. הרץ את הפקודות הבאות **בסדר** (החלף `YOUR_USERNAME` בשם המשתמש שלך ב־GitHub):

   ```bash
   git init
   git add .
   git commit -m "העלאת בלוג משחקים"
   git branch -M main
   git remote add origin https://github.com/YOUR_USERNAME/gaming-blog.git
   git push -u origin main
   ```

4. אם יתבקש – הזן שם משתמש וסיסמה של GitHub (או Token אם יש 2FA).
5. אחרי ש־`git push` מסתיים, רענן את דף ה־Repository ב־GitHub – אמור להופיע שם כל הקוד.

---

## חלק 3: Netlify (הרצת האתר)

**מבנה הפרויקט ב־GitHub (מה אמור להיות ב־repo):**

```text
gaming-blog/
├── netlify-app/           ← התיקייה Netlify בונה מתוכה
│   ├── netlify.toml       ← קובץ הגדרות Netlify
│   ├── package.json       ← תלויות ופקודת build
│   ├── astro.config.mjs
│   ├── public/
│   ├── scripts/
│   └── src/
├── supabase/
│   └── schema.sql
├── public/                ← גרסת PHP (לא בשימוש ב־Netlify)
├── admin/
└── ...
```

אם ב־GitHub **אין** תיקייה בשם `netlify-app` (ובתוכה `netlify.toml` ו־`package.json`) – חזור לחלק 2 והעלה שוב את כל הפרויקט.

---

### שלב 3.1 – חיבור Netlify ל־GitHub

1. היכנס ל־**[netlify.com](https://netlify.com)**.
2. לחץ **Sign up** או **Log in** – בחר **Sign up with GitHub** (נוח).
3. אחרי ההתחברות לחץ **Add new site** → **Import an existing project**.
4. לחץ **Deploy with GitHub**.
5. אם מתבקש – אשר גישה ל־GitHub ובחר **Only select repositories** → בחר את `gaming-blog` (או השם שבחרת).
6. ברשימת ה־repos בחר **gaming-blog**.

---

### שלב 3.2 – הגדרות בנייה (איפה Netlify יבנה את האתר)

אחרי שבחרת את ה־repo **gaming-blog**, Netlify מציג מסך עם כותרת כמו **"Branch to deploy and build settings"**.  
במסך הזה יש כמה שדות – צריך להגיד ל־Netlify **מתוך איזו תיקייה** לבנות את האתר ו**איפה התוצאה**.

**למה זה חשוב:**  
בפרויקט שלך האתר של Netlify נמצא **בתוך תיקייה** בשם `netlify-app`, לא בשורש.  
הקבצים `netlify.toml` ו־`package.json` נמצאים **בתוך** התיקייה הזו:

- `netlify-app/netlify.toml`
- `netlify-app/package.json`

אם לא נגיד ל־Netlify "עבוד מתוך `netlify-app`", הוא ינסה לבנות מהשורש וייכשל (וייתכן שתקבל 404 על הקבצים האלה).

**אם אתה לא רואה את התיקייה `netlify-app` ב־GitHub:**  
וודא שדחפת את **כל** הפרויקט: `git add .` ואז `git commit` ו־`git push`. אם התיקייה חסרה ב־repo – הרץ שוב מהמחשב (מתוך תיקיית `gaming-blog`) את הפקודות האלה והעלה מחדש.

**מה לעשות – שלב־אחר־שלב:**

1. **Branch to deploy**  
   השאר כמו שזה: `main`. לא צריך לשנות.

2. **Base directory** (תיקיית הבסיס)  
   - אמור להיות כתוב משהו כמו **"Base directory"** ולצדו שדה (או "Options" / "Edit settings").  
   - לחץ על **Options** או **Edit settings** ליד Base directory (אם יש כפתור כזה).  
   - בשדה שהתפנה, הקלד **בדיוק** (בלי רווחים לפני/אחרי):  
     ```text
     netlify-app
     ```  
   - **במילים:** Netlify ירוץ את כל הפקודות (התקנה ובנייה) **מתוך התיקייה** `netlify-app` שבפרויקט.

3. **Build command** (פקודת הבנייה)  
   - חפש שדה בשם **"Build command"**.  
   - אמור להיות שם כבר: `npm run build`.  
   - אם השדה ריק – הקלד:  
     ```text
     npm run build
     ```  
   - **במילים:** זו הפקודה ש־Netlify מריץ כדי לבנות את האתר (התקנת חבילות והרצת Astro).

4. **Publish directory** (תיקיית הפרסום)  
   - חפש שדה בשם **"Publish directory"** או **"Directory that contains the deploy-ready HTML files"**.  
   - בשדה הזה הקלד **בדיוק**:  
     ```text
     dist
     ```  
   - **במילים:** אחרי ש־`npm run build` מסתיים, הקבצים המוכנים לפרסום נוצרים בתיקייה `dist`. Netlify לוקח **את התוכן של התיקייה הזו** ומעלה אותו לאתר החי.

**סיכום קצר:**

| שדה              | מה להזין      | למה |
|------------------|---------------|-----|
| Base directory   | `netlify-app` | כי האתר של Netlify נמצא בתיקייה הזו. |
| Build command    | `npm run build` | הפקודה שבונה את האתר. |
| Publish directory| `dist`        | התיקייה שבה נמצאת התוצאה המוכנה. |

אחרי שמילאת את שלושת השדות, **אל תלחץ עדיין על Deploy** – בשלב הבא (3.3) נוסיף את מפתחות Supabase.

**אם כבר יצרת את האתר ב־Netlify:**  
היכנס ל־**Site configuration** (או **Site settings**) → **Build & deploy** → **Build settings** → **Edit settings** → הגדר **Base directory** ל־`netlify-app` ושמור. אחר כך **Trigger deploy** → **Deploy site**.

---

### שלב 3.3 – הוספת משתני הסביבה (מפתחות Supabase)

1. באותו מסך, גלול למטה ל־**Environment variables**.
2. לחץ **Add environment variables** → **Add a single variable**.
3. הוסף **שני** משתנים (בכל פעם **Key** ו־**Value**):

   **משתנה ראשון:**
   - **Key:** `PUBLIC_SUPABASE_URL`
   - **Value:** הדבק את ה־**Project URL** שהעתקת מ־Supabase (שלב 1.3).

   **משתנה שני:**
   - **Key:** `PUBLIC_SUPABASE_ANON_KEY`
   - **Value:** הדבק את ה־**anon key** שהעתקת מ־Supabase (שלב 1.3).

4. לחץ **Save** / **Add**.

---

### שלב 3.4 – הפעלת הדיפלוי

1. גלול לתחתית המסך.
2. לחץ **Deploy site** (או **Deploy gaming-blog**).
3. חכה 1–2 דקות עד ש־**Published** מופיע בירוק.
4. לחץ על **הכתובת של האתר** (משהו כמו `https://something.netlify.app`) – האתר אמור להיפתח.

---

## חלק 4: Supabase – הגדרת כתובת האתר (להשלמת ההתחברות)

כדי שההתחברות וההרשמה יעבדו מהאתר ב־Netlify:

1. חזור ל־**Supabase** → הפרויקט שלך.
2. בתפריט השמאלי: **Authentication** → **URL Configuration**.
3. בשדה **Site URL** הזן את כתובת האתר מ־Netlify, למשל:
   ```text
   https://something.netlify.app
   ```
   (העתק מהדפדפן את הכתובת המלאה)
4. בשדה **Redirect URLs** הוסף שורה:
   ```text
   https://something.netlify.app/**
   ```
   (אותו כתובת + `/**`)
5. לחץ **Save**.

---

## חלק 5: בדיקה

1. גלוש לכתובת האתר ב־Netlify.
2. לחץ **הרשמה** – הירשם עם אימייל וסיסמה (המשתמש הראשון יהפוך אוטומטית ל־admin).
3. לחץ **התחברות** – התחבר עם אותם פרטים.
4. גלוש ל־**פאנל ניהול** (או `/admin`) – צור **עמוד** וצור **פוסט**.
5. חזור ל־**ראשי** ובדוק שהפוסט והעמוד מופיעים.

---

## סיכום – סדר הפעולות

| # | מה עושים | איפה |
|---|----------|------|
| 1 | יוצרים פרויקט Supabase ומריצים את `schema.sql` | supabase.com |
| 2 | מעתיקים Project URL ו־anon key | Supabase → Settings → API |
| 3 | יוצרים Repository ב־GitHub ומעלים את הקוד עם `git` | github.com + Terminal |
| 4 | מחברים את Netlify ל־repo ומגדירים Base: `netlify-app`, Publish: `dist` | netlify.com |
| 5 | מוסיפים ב־Netlify את `PUBLIC_SUPABASE_URL` ו־`PUBLIC_SUPABASE_ANON_KEY` | Netlify → Environment variables |
| 6 | מגדירים ב־Supabase את Site URL ו־Redirect URLs לכתובת Netlify | Supabase → Authentication → URL Configuration |
| 7 | נכנסים לאתר, נרשמים, מתחברים ומוסיפים תוכן | הדפדפן |

---

## 404 על netlify.toml / package.json (בקונסול של Netlify)

אם בקונסול של הדפדפן (בממשק Netlify) אתה רואה:

```text
api.github.com/repos/.../gaming-blog/contents/netlify.toml?ref=main 404
api.github.com/repos/.../gaming-blog/contents/package.json?ref=main 404
```

**סיבה:** Netlify מחפש את `netlify.toml` ו־`package.json` **בשורש** ה־repo, אבל אצלך הם נמצאים **בתוך** התיקייה `netlify-app/`.

**פתרון:**  
וודא שב־Netlify מוגדרת **Base directory** = `netlify-app`:

1. ב־Netlify: **Site configuration** (או **Site settings**) → **Build & deploy**.
2. תחת **Build settings** לחץ **Edit settings** (או **Options**).
3. בשדה **Base directory** הזן **בדיוק:** `netlify-app`.
4. שמור (**Save**).
5. הרץ דיפלוי מחדש: **Deploy site** → **Trigger deploy** → **Deploy site**.

אחרי זה Netlify ירוץ את הבנייה מתוך `netlify-app` וימצא שם את `netlify.toml` ו־`package.json`. השגיאות 412 ו־fetch-site-configuration הן בדרך כלל של ממשק Netlify ולא חוסמות את הדיפלוי.

---

## "Repository not found" ב־git push

אם קיבלת:
```text
remote: Repository not found.
fatal: repository 'https://github.com/opkl10/gaming-blog.git/' not found
```

עשה את זה **בסדר**:

1. **וודא שהמאגר קיים ב־GitHub**
   - היכנס ל־**[github.com/opkl10](https://github.com/opkl10)** (או לחשבון שלך).
   - בדוק אם יש repo בשם **gaming-blog**.
   - אם **אין** – צור מאגר חדש:
     - לחץ **+** → **New repository**
     - **Repository name:** `gaming-blog` (בדיוק ככה, בלי רווחים).
     - השאר Public, **אל תסמן** "Add a README".
     - לחץ **Create repository**.

2. **וודא את כתובת ה־remote**
   - בטרמינל, מתוך תיקיית הפרויקט:
     ```bash
     cd /Users/omerokon/Desktop/bf6/gaming-blog
     git remote -v
     ```
   - אמור להופיע משהו כמו:
     ```text
     origin  https://github.com/opkl10/gaming-blog.git (fetch)
     origin  https://github.com/opkl10/gaming-blog.git (push)
     ```
   - אם השם או המשתמש שונים – עדכן:
     ```bash
     git remote remove origin
     git remote add origin https://github.com/opkl10/gaming-blog.git
     ```

3. **התחברות ל־GitHub**
   - GitHub כבר לא מקבל סיסמה רגילה ב־HTTPS. צריך **Personal Access Token**:
     - ב־GitHub: **Settings** (פרופיל) → **Developer settings** → **Personal access tokens** → **Tokens (classic)**.
     - **Generate new token (classic)**.
     - תן שם (למשל `netlify-blog`), סמן **repo**, לחץ **Generate**.
     - **העתק את ה־Token** (פעם אחת בלבד – לא תוכל לראות שוב).
   - כשמריצים `git push` ומתבקשים:
     - **Username:** `opkl10` (שם המשתמש ב־GitHub).
     - **Password:** הדבק את **ה־Token** (לא את סיסמת החשבון).

4. **נסה שוב**
   ```bash
   git push -u origin main
   ```

אם עדיין "not found" – וודא שאתה מחובר לחשבון הנכון ב־GitHub (אותו משתמש כמו ב־`opkl10`).

---

## בעיות נפוצות

- **"Database connection" / שגיאות Supabase**  
  וודא שהדבקת נכון את ה־URL וה־anon key ב־Netlify (Environment variables), ושמרת אחרי הוספתם.

- **התחברות/הרשמה לא עובדות**  
  וודא ב־Supabase ב־URL Configuration ש־Site URL ו־Redirect URLs זהים לכתובת האתר ב־Netlify (כולל `https://`).

- **האתר לא נבנה ב־Netlify**  
  וודא ש־Base directory הוא בדיוק `netlify-app` וש־Publish directory הוא `dist`.

- **אין לי גישה ל־admin**  
  רק המשתמש **הראשון** שנרשם מקבל אוטומטית הרשאת admin. אם נרשמת שני – היכנס ל־Supabase → Table Editor → `profiles` ועדכן את ה־`role` של המשתמש ל־`admin`.
